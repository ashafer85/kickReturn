<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title> kick Return </title>
  </head>
  <body>

      <style>
      * { padding: 0; margin-top: 0; }
      canvas { background: #44d203; display: block; margin: 20 auto; }
      </style>
      <script>
        document.addEventListener('DOMContentLoaded', () => {

          var krCanvas = document.getElementById('kr-canvas');
          var ctx = krCanvas.getContext('2d');

          let krX = krCanvas.width/2;
          let krY = krCanvas.height - 100;
          let krRadius = 16;
          let krDirStart = 0;
          let krDirEnd = krDirStart + Math.PI;
          let krDirVector = krDirStart - Math.PI/2;
          let krDelta = 24;
          let krJukeMultiple = 2;
          let krDeltaY;
          let krDeltaX;
          let krColorB = "#068653";
          let krColorT = "white";

          let spreadX;
          let spreadY;

          let defX = Math.floor(krCanvas.width*Math.random());
          let defY = krCanvas.height - (krCanvas.height - 80);
          let defRadius = krRadius;
          let defDirStart = 0;
          let defDirEnd = defDirStart + Math.PI;
          let defDirVector = defDirStart - Math.PI/2;
          let defDelta = 20;
          let defDeltaY;
          let defDeltaX;
          let defColorB = "#ffcb05";
          let defColorT = "#144498";
          let pastDef = false;

          const renderKR = () => {
            ctx.beginPath();
            ctx.arc(krX, krY, krRadius, krDirStart, krDirEnd, false);
            ctx.fillStyle = krColorB;
            ctx.fill();
            ctx.closePath();
            ctx.beginPath();
            ctx.arc(krX, krY, krRadius, krDirStart, krDirEnd, true);
            ctx.fillStyle = krColorT;
            ctx.fill();
            ctx.closePath();
          }

          const trigKR = (ref, bool = true) => {
            if (Math.sin(krDirVector) >= 0) {
              krDeltaY = Math.floor(krDelta*Math.sin(ref));
            } else {
              krDeltaY = Math.ceil(krDelta*Math.sin(ref));
            }
            if (Math.cos(krDirVector) >= 0) {
              krDeltaX = Math.floor(krDelta*Math.cos(ref));
            } else {
              krDeltaX = Math.ceil(krDelta*Math.cos(ref));
            }
            if (bool === true) {
              krY += krDeltaY;
              krX += krDeltaX;
            } else {
              krY -= krDeltaY;
              krX -= krDeltaX;
            }
          }

          const trigDef = () => {
            spreadX = defX - krX;
            spreadY = defY - krY;
            if (krY < defY) {
              defDirVector = Math.PI/2 - Math.atan(spreadX/spreadY);
              defDirStart = defDirVector + Math.PI/2;
              defDirEnd = defDirStart - Math.PI;
            } else {
              defDirVector = Math.PI/2 - Math.atan(spreadX/spreadY);
              defDirStart = defDirVector - Math.PI/2;
              defDirEnd = defDirStart + Math.PI;
            }

            if (Math.sin(defDirVector) >= 0) {
              defDeltaY = Math.floor(defDelta*Math.sin(defDirVector));
            } else {
              defDeltaY = Math.ceil(defDelta*Math.sin(defDirVector));
            }
            if (Math.cos(defDirVector) >= 0) {
              defDeltaX = Math.floor(defDelta*Math.cos(defDirVector));
            } else {
              defDeltaX = Math.ceil(defDelta*Math.cos(defDirVector));
            }
            if (krY < defY) {
              defY -= defDeltaY;
              defX -= defDeltaX;
            } else {
              defY += defDeltaY;
              defX += defDeltaX;
            }
          }
          const renderDef = () => {
            ctx.beginPath();
            ctx.arc(defX, defY, defRadius, defDirStart, defDirEnd, pastDef);
            ctx.fillStyle = defColorB;
            ctx.fill();
            ctx.closePath();
            ctx.beginPath();
            ctx.arc(defX, defY, defRadius, defDirStart, defDirEnd, !pastDef);
            ctx.fillStyle = defColorT;
            ctx.fill();
            ctx.closePath();
          }

          const clearField = () => {
            ctx.clearRect(0, 0, krCanvas.width, krCanvas.height);
          }
          renderKR();
          renderDef();

          document.addEventListener('keydown', (e) => {
            console.log(e.keyCode)
            switch(e.keyCode) {
              case(38):
                trigKR(krDirVector);
                clearField()
                renderKR();
                trigDef();
                renderDef();
                break;
              case(40):
                trigKR(krDirVector, false);
                clearField();
                renderKR();
                trigDef();
                renderDef();
                break;
              case(39):
                krDirStart += Math.PI/4;
                krDirEnd = krDirStart + Math.PI;
                krDirVector = krDirStart - Math.PI/2;
                clearField();
                renderKR();
                renderDef();
                break;
              case(37):
                krDirStart -= Math.PI/4;
                krDirEnd = krDirStart + Math.PI;
                krDirVector = krDirStart - Math.PI/2;
                clearField();
                renderKR();
                renderDef();
                break;
              case(83):
                trigKR(krDirEnd);
                clearField();
                renderKR();
                trigDef();
                renderDef();
                break;
              case(68):
                trigKR(krDirStart);
                clearField();
                renderKR();
                trigDef();
                renderDef();
                break;
            };
          });
        });
      </script>
      <h1> Kick Return </h1>
      <canvas id='kr-canvas' width=600 height=400></canvas>
      <div class='instructions-container'>
        <h3> Controls: </h3>
        <ul class='movements'>
          <li> 'Up' Arrow: Forward  </li>
          <li> 'Down' Arrow: Backward  </li>
          <li> 'Left' Arrow: Turn Left  </li>
          <li> 'Right' Arrow: Turn Right  </li>
          <li> 'S' Key: Step Left  </li>
          <li> 'D' Key: Step Right  </li>
        </ul>
      </div>
  </body>
</html>
